C51 COMPILER V9.60.7.0   CH451                                                             11/14/2023 20:26:08 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE CH451
OBJECT MODULE PLACED IN .\Objects\ch451.obj
COMPILER INVOKED BY: D:\c51\C51\BIN\C51.EXE Ch451\ch451.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\Delay;.\Keyboard;.\Nixie;.\T
                    -imer;.\Ds18b20;.\Ch451) DEBUG OBJECTEXTEND PRINT(.\Listings\ch451.lst) TABS(2) OBJECT(.\Objects\ch451.obj)

line level    source

   1          #include"ch451.h"
   2          
   3          #include<reg51.h>
   4          
   5          #define  USE_KEY  1
   6          
   7          unsigned char  ch451_key=0xff;                    // 存放键盘中断中读取的键值
   8          //初始化子程序
   9          
  10          void ch451_init()
  11          {
  12   1        ch451_din=0;                                     //先低后高，选择4线输入
  13   1        ch451_din=1;
  14   1      #ifdef USE_KEY
  15   1        IT1=0;                        //设置下降沿触发
  16   1        IE1=0;                        //清中断标志
  17   1        PX1=0;                        //设置低优先级
  18   1        EX1=1;                        //开中断
  19   1      #endif
  20   1      
  21   1      }
  22          //*****************************************************
  23          
  24           //输出命令子程序
  25           //定义一无符号整型变量存储12字节的命令字。
  26           void ch451_write(unsigned int command)
  27          {
  28   1        unsigned char i;
  29   1      #ifdef USE_KEY
  30   1        EX1=0;                       //禁止键盘中断
  31   1      #endif  
  32   1        ch451_load=0;                                  //命令开始       
  33   1        for(i=0;i<12;i++){                             //送入12位数据，低位在前
  34   2          ch451_din=command&1;        
  35   2          ch451_dclk=0;
  36   2          command>>=1;
  37   2          ch451_dclk=1;                               //上升沿有效
  38   2        }
  39   1        ch451_load=1;                                 //加载数据
  40   1      #ifdef USE_KEY
  41   1        EX1=1;
  42   1      #endif
  43   1      }
  44          
  45          #ifdef USE_KEY
  46          
  47          //*************************************************
  48          //输入命令子程序，MCU从451读一字节
  49           unsigned char ch451_read()
  50          {
  51   1        unsigned char i;
  52   1        unsigned char command,keycode;    //定义命令字，和数据存储器
  53   1        EX1=0;                     //关中段  
  54   1        command=0x07;                    //输入读451命令字  
C51 COMPILER V9.60.7.0   CH451                                                             11/14/2023 20:26:08 PAGE 2   

  55   1        ch451_load=0;
  56   1        for(i=0;i<4;i++){
  57   2       
  58   2          ch451_din=command&1;          //送入最低位
  59   2          ch451_dclk=0;      
  60   2          command>>=1;            //往右移一位
  61   2          ch451_dclk=1;           //产生时钟上升沿锁通知CH451输入位数据
  62   2       }
  63   1        ch451_load=1;             //产生加载上升沿通知CH451处理命令数据
  64   1        keycode=0;              //清除keycode
  65   1        for(i=0;i<7;i++){
  66   2          keycode<<=1;            //数据移入keycode,高位在前,低位在后
  67   2          keycode|=ch451_dout;          //从高到低读入451的数据
  68   2          ch451_dclk=0;           //产生时钟下升沿通知CH451输出下一位
  69   2          ch451_dclk=1;
  70   2       }
  71   1        IE1=0;              //清中断标志
  72   1        EX1=1;
  73   1        return(keycode);           //反回键值
  74   1      }
  75          //*************************************************
  76          //中断子程序  使用中断2，寄存器组1
  77          
  78          void ch451_inter() interrupt 2
  79          {
  80   1        unsigned char i;            //定义循环变量
  81   1        unsigned char command,keycode;        //定义控制字寄存器，和中间变量定时器
  82   1        command=0x07;             //读取键值命令的高4位0111B
  83   1        ch451_load=0;             //命令开始
  84   1        for(i=0;i<4;i++){
  85   2          ch451_din=command&1;         //低位在前,高位在后
  86   2          ch451_dclk=0;
  87   2          command>>=1;           //右移一位
  88   2          ch451_dclk=1;          //产生时钟上升沿锁通知CH451输入位数据
  89   2       }
  90   1        ch451_load=1;            //产生加载上升沿通知CH451处理命令数据
  91   1        keycode=0;             //清除keycode
  92   1        for(i=0;i<7;i++){
  93   2          keycode<<=1;           //数据作移一位,高位在前,低位在后
  94   2          keycode|=ch451_dout;         //从高到低读入451的数据
  95   2          ch451_dclk=0;          //产生时钟下升沿通知CH451输出下一位
  96   2          ch451_dclk=1;
  97   2       }
  98   1        ch451_key=keycode;          //保存上次的键值
  99   1      
 100   1        IE=0;           //清中断标志
 101   1      }
 102          
 103          //***********************************************
 104          
 105          #endif 


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    165    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.

C51 COMPILER V9.60.7.0   CH451                                                             11/14/2023 20:26:08 PAGE 3   


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
